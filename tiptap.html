<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Tiptap Editor</title>
    <!-- React -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <!-- Tiptap CDN (correct UMD paths) -->
    <script src="https://unpkg.com/@tiptap/core@2.1.13"></script>
    <script src="https://unpkg.com/@tiptap/react@2.1.13"></script>
    <script src="https://unpkg.com/@tiptap/starter-kit@2.1.13"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: #fff;
            color: #37352f;
            padding: 40px 20px;
        }
        
        .editor-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .editor-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 40px;
            text-align: center;
            color: #37352f;
        }
        
        .editor-toolbar {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
            padding: 8px;
            border: 1px solid #e9e9e7;
            border-radius: 6px;
            background: #fafafa;
            flex-wrap: wrap;
        }
        
        .toolbar-btn {
            padding: 6px 8px;
            border: 1px solid transparent;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.1s;
            min-width: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .toolbar-btn:hover {
            background: #e9e9e7;
        }
        
        .toolbar-btn.is-active {
            background: #2383e2;
            color: white;
        }
        
        .toolbar-separator {
            width: 1px;
            background: #e9e9e7;
            margin: 4px 4px;
        }
        
        .editor-wrapper {
            border: 1px solid #e9e9e7;
            border-radius: 8px;
            background: white;
        }
        
        .ProseMirror {
            outline: none;
            padding: 20px;
            min-height: 400px;
            font-size: 16px;
            line-height: 1.6;
            color: #37352f;
        }
        
        .ProseMirror:focus {
            outline: none;
        }
        
        .ProseMirror h1 {
            font-size: 28px;
            font-weight: 700;
            margin: 20px 0 12px;
            color: #37352f;
        }
        
        .ProseMirror h2 {
            font-size: 24px;
            font-weight: 600;
            margin: 18px 0 10px;
            color: #37352f;
        }
        
        .ProseMirror h3 {
            font-size: 20px;
            font-weight: 600;
            margin: 16px 0 8px;
            color: #37352f;
        }
        
        .ProseMirror p {
            margin: 8px 0;
        }
        
        .ProseMirror p:first-child {
            margin-top: 0;
        }
        
        .ProseMirror ul, .ProseMirror ol {
            padding-left: 24px;
            margin: 8px 0;
        }
        
        .ProseMirror li {
            margin: 4px 0;
        }
        
        .ProseMirror blockquote {
            border-left: 3px solid #e9e9e7;
            padding-left: 16px;
            margin: 16px 0;
            color: #6f6f6f;
            font-style: italic;
        }
        
        .ProseMirror code {
            background: #f7f6f3;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 14px;
        }
        
        .ProseMirror pre {
            background: #f7f6f3;
            padding: 16px;
            border-radius: 6px;
            margin: 16px 0;
            overflow-x: auto;
        }
        
        .ProseMirror pre code {
            background: none;
            padding: 0;
        }
        
        .ProseMirror strong {
            font-weight: 700;
        }
        
        .ProseMirror em {
            font-style: italic;
        }
        
        .ProseMirror s {
            text-decoration: line-through;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Tiptapツールバーコンポーネント
        function TiptapToolbar({ editor }) {
            if (!editor) return null;

            return (
                <div className="editor-toolbar">
                    <button
                        className={`toolbar-btn ${editor.isActive('bold') ? 'is-active' : ''}`}
                        onClick={() => editor.chain().focus().toggleBold().run()}
                        title="太字"
                    >
                        <strong>B</strong>
                    </button>
                    
                    <button
                        className={`toolbar-btn ${editor.isActive('italic') ? 'is-active' : ''}`}
                        onClick={() => editor.chain().focus().toggleItalic().run()}
                        title="斜体"
                    >
                        <em>I</em>
                    </button>
                    
                    <button
                        className={`toolbar-btn ${editor.isActive('strike') ? 'is-active' : ''}`}
                        onClick={() => editor.chain().focus().toggleStrike().run()}
                        title="取り消し線"
                    >
                        <s>S</s>
                    </button>
                    
                    <button
                        className={`toolbar-btn ${editor.isActive('code') ? 'is-active' : ''}`}
                        onClick={() => editor.chain().focus().toggleCode().run()}
                        title="コード"
                    >
                        {'</>'}
                    </button>
                    
                    <div className="toolbar-separator"></div>
                    
                    <button
                        className={`toolbar-btn ${editor.isActive('heading', { level: 1 }) ? 'is-active' : ''}`}
                        onClick={() => editor.chain().focus().toggleHeading({ level: 1 }).run()}
                        title="見出し1"
                    >
                        H1
                    </button>
                    
                    <button
                        className={`toolbar-btn ${editor.isActive('heading', { level: 2 }) ? 'is-active' : ''}`}
                        onClick={() => editor.chain().focus().toggleHeading({ level: 2 }).run()}
                        title="見出し2"
                    >
                        H2
                    </button>
                    
                    <button
                        className={`toolbar-btn ${editor.isActive('heading', { level: 3 }) ? 'is-active' : ''}`}
                        onClick={() => editor.chain().focus().toggleHeading({ level: 3 }).run()}
                        title="見出し3"
                    >
                        H3
                    </button>
                    
                    <div className="toolbar-separator"></div>
                    
                    <button
                        className={`toolbar-btn ${editor.isActive('bulletList') ? 'is-active' : ''}`}
                        onClick={() => editor.chain().focus().toggleBulletList().run()}
                        title="箇条書きリスト"
                    >
                        •
                    </button>
                    
                    <button
                        className={`toolbar-btn ${editor.isActive('orderedList') ? 'is-active' : ''}`}
                        onClick={() => editor.chain().focus().toggleOrderedList().run()}
                        title="番号付きリスト"
                    >
                        1.
                    </button>
                    
                    <button
                        className={`toolbar-btn ${editor.isActive('blockquote') ? 'is-active' : ''}`}
                        onClick={() => editor.chain().focus().toggleBlockquote().run()}
                        title="引用"
                    >
                        "
                    </button>
                    
                    <button
                        className={`toolbar-btn ${editor.isActive('codeBlock') ? 'is-active' : ''}`}
                        onClick={() => editor.chain().focus().toggleCodeBlock().run()}
                        title="コードブロック"
                    >
                        {'{}'}
                    </button>
                    
                    <div className="toolbar-separator"></div>
                    
                    <button
                        className="toolbar-btn"
                        onClick={() => editor.chain().focus().undo().run()}
                        disabled={!editor.can().undo()}
                        title="元に戻す"
                    >
                        ↶
                    </button>
                    
                    <button
                        className="toolbar-btn"
                        onClick={() => editor.chain().focus().redo().run()}
                        disabled={!editor.can().redo()}
                        title="やり直し"
                    >
                        ↷
                    </button>
                </div>
            );
        }

        // メインのTiptapエディターコンポーネント
        function TiptapEditor() {
            const [editor, setEditor] = useState(null);
            const [error, setError] = useState(null);
            const editorRef = useRef(null);

            useEffect(() => {
                // モジュールの読み込み確認とデバッグ
                console.log('Available globals:', {
                    Tiptap: !!window.Tiptap,
                    TiptapCore: !!window.TiptapCore,
                    TiptapReact: !!window.TiptapReact,
                    TiptapStarterKit: !!window.TiptapStarterKit
                });

                // 利用可能なTiptapバージョンを探す
                let Editor, StarterKit;
                
                if (window.Tiptap?.Editor && window.TiptapStarterKit?.StarterKit) {
                    Editor = window.Tiptap.Editor;
                    StarterKit = window.TiptapStarterKit.StarterKit;
                } else if (window.TiptapCore?.Editor && window.TiptapStarterKit?.StarterKit) {
                    Editor = window.TiptapCore.Editor;
                    StarterKit = window.TiptapStarterKit.StarterKit;
                } else {
                    setError('Tiptapモジュールが正しく読み込まれていません');
                    return;
                }

                try {
                    // エディターインスタンスを作成
                    const editorInstance = new Editor({
                        element: editorRef.current,
                        extensions: [StarterKit],
                        content: `
                            <h1>Tiptap エディター</h1>
                            <p>このエディターでは以下のことができます：</p>
                            <ul>
                                <li><strong>太字</strong>や<em>斜体</em>、<s>取り消し線</s></li>
                                <li><code>インラインコード</code></li>
                                <li>見出し（H1, H2, H3）</li>
                                <li>箇条書きリスト</li>
                                <li>番号付きリスト</li>
                            </ul>
                            <blockquote>
                                引用ブロックも使えます
                            </blockquote>
                            <pre><code>// コードブロック
function hello() {
    console.log('Hello, Tiptap!');
}</code></pre>
                            <p>キーボードショートカットも利用できます：</p>
                            <ul>
                                <li><strong>Ctrl/Cmd + B</strong>: 太字</li>
                                <li><strong>Ctrl/Cmd + I</strong>: 斜体</li>
                                <li><strong>Ctrl/Cmd + Shift + X</strong>: 取り消し線</li>
                                <li><strong>Ctrl/Cmd + Z</strong>: 元に戻す</li>
                                <li><strong>Ctrl/Cmd + Y</strong>: やり直し</li>
                            </ul>
                        `,
                        editorProps: {
                            attributes: {
                                class: 'prose prose-sm sm:prose lg:prose-lg xl:prose-2xl mx-auto focus:outline-none',
                            },
                        },
                    });

                    setEditor(editorInstance);
                } catch (err) {
                    console.error('Editor initialization error:', err);
                    setError(`エディターの初期化に失敗しました: ${err.message}`);
                }

                // クリーンアップ関数
                return () => {
                    if (editorInstance) {
                        editorInstance.destroy();
                    }
                };
            }, []);

            if (error) {
                return (
                    <div className="editor-container">
                        <h1 className="editor-title">Simple Tiptap Editor</h1>
                        <div style={{ 
                            padding: '20px', 
                            background: '#f8d7da', 
                            color: '#721c24', 
                            border: '1px solid #f5c6cb',
                            borderRadius: '6px'
                        }}>
                            エラー: {error}
                        </div>
                    </div>
                );
            }

            return (
                <div className="editor-container">
                    <h1 className="editor-title">Simple Tiptap Editor</h1>
                    
                    <TiptapToolbar editor={editor} />
                    
                    <div className="editor-wrapper">
                        <div ref={editorRef} />
                    </div>
                </div>
            );
        }

        // アプリをレンダリング
        ReactDOM.render(<TiptapEditor />, document.getElementById('root'));
    </script>
</body>
</html>
