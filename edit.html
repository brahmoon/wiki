<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NotionÈ¢®Wiki</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: #fff;
            color: #37352f;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        .sidebar {
            width: 240px;
            background: #f7f6f3;
            border-right: 1px solid #e9e9e7;
            padding: 20px 0;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid #e9e9e7;
            margin-bottom: 20px;
        }
        
        .sidebar-title {
            font-size: 14px;
            font-weight: 600;
            color: #37352f;
        }
        
        .page-list {
            list-style: none;
        }
        
        .page-item {
            padding: 8px 20px;
            cursor: pointer;
            font-size: 14px;
            color: #37352f;
            transition: background 0.1s;
            border-radius: 4px;
            margin: 2px 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .page-item:hover {
            background: #e9e9e7;
        }
        
        .page-item.active {
            background: #2383e2;
            color: white;
        }
        
        .page-item-title {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            height: 60px;
            border-bottom: 1px solid #e9e9e7;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }
        
        .header-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border: 1px solid #d3d2ce;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.1s;
            font-weight: 500;
        }
        
        .btn:hover {
            background: #f7f6f3;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: #2383e2;
            color: white;
            border-color: #2383e2;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #1a6bc2;
        }
        
        .editor-container {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }
        
        .editor {
            max-width: 700px;
            margin: 0 auto;
        }
        
        .page-title {
            font-size: 40px;
            font-weight: 700;
            border: none;
            outline: none;
            width: 100%;
            margin-bottom: 20px;
            color: #37352f;
            background: transparent;
        }
        
        .page-title::placeholder {
            color: #9b9a97;
        }
        
        .editor-content {
            font-size: 16px;
            line-height: 1.6;
            border: none;
            outline: none;
            width: 100%;
            min-height: 400px;
            resize: vertical;
            font-family: inherit;
            background: transparent;
        }
        
        .editor-content::placeholder {
            color: #9b9a97;
        }
        
        .viewer-content {
            font-size: 16px;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            gap: 20px;
            text-align: center;
        }
        
        .login-container h1 {
            color: #37352f;
            font-weight: 700;
        }
        
        .login-container p {
            color: #9b9a97;
            max-width: 400px;
        }
        
        .status-message {
            padding: 12px 20px;
            margin: 0 20px 10px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .new-page-form {
            display: flex;
            gap: 8px;
            padding: 20px;
            border-top: 1px solid #e9e9e7;
        }
        
        .new-page-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d3d2ce;
            border-radius: 4px;
            font-size: 13px;
            outline: none;
        }
        
        .new-page-input:focus {
            border-color: #2383e2;
        }
        
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            gap: 20px;
            text-align: center;
            color: #9b9a97;
        }
        
        .welcome-screen h2 {
            color: #37352f;
            font-weight: 600;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2383e2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .config-notice {
            background: #fff3cd;
            color: #856404;
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 6px;
            border: 1px solid #ffeaa7;
        }
        
        .config-notice strong {
            display: block;
            margin-bottom: 5px;
        }
        
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid #e9e9e7;
            }
            
            .editor-container {
                padding: 20px;
            }
            
            .page-title {
                font-size: 32px;
            }
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading-container" style="display: flex; align-items: center; justify-content: center; height: 100vh; gap: 10px;">
            <div class="loading-spinner"></div>
            <span>ÂàùÊúüÂåñ‰∏≠...</span>
        </div>
    </div>

    <script>
        const CONFIG = {
            APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbxzq-iDY4y5wyFV2bvaReNJ1N4fv_0xcqPn4zNYBdwUGI5QR8HKc0TcxA11thIgJL4z8g/exec',
            CLIENT_ID: '680055548295-hv2bpt4untk1agai47l5c33p7hdp6hro.apps.googleusercontent.com'
            // ÈñãÁô∫„É¢„Éº„ÉâÔºà„Éá„É¢Áî®Ôºâ
            DEMO_MODE: false
        };

        class WikiApp {
            constructor() {
                this.state = {
                    isAuthenticated: false,
                    authInstance: null,
                    pages: [],
                    currentPage: null,
                    isEditing: false,
                    title: '',
                    content: '',
                    statusMessage: '',
                    newPageTitle: '',
                    loading: false,
                    initialized: false
                };
                
                this.init();
            }
            
            async init() {
                try {
                    if (CONFIG.DEMO_MODE) {
                        // „Éá„É¢„É¢„Éº„ÉâÔºö„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Çí‰ΩøÁî®
                        this.initLocalStorage();
                        this.setState({ 
                            isAuthenticated: true, 
                            initialized: true 
                        });
                        await this.loadPages();
                    } else {
                        // Êú¨Áï™„É¢„Éº„ÉâÔºöGoogleË™çË®º„Çí‰ΩøÁî®
                        await this.initGoogleAuth();
                        this.setState({ initialized: true });
                    }
                } catch (error) {
                    console.error('ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                    this.setState({ 
                        statusMessage: 'ÂàùÊúüÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇË®≠ÂÆö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                        initialized: true 
                    });
                }
                
                this.render();
            }
            
            initLocalStorage() {
                const storageKey = 'notion-wiki-pages';
                if (!localStorage.getItem(storageKey)) {
                    const defaultPages = [
                        {
                            id: '1',
                            title: '„ÅØ„Åò„ÇÅ„Å´',
                            content: `„Åì„ÅÆWiki„Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ

## ÁèæÂú®„ÅÆÁä∂ÊÖã
„Åì„ÅÆ„Ç¢„Éó„É™„ÅØ„Éá„É¢„É¢„Éº„Éâ„ÅßÂãï‰Ωú„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇGoogle Apps Script„Å®„ÅÆÁµ±Âêà„ÇíË°å„ÅÜ„Å´„ÅØ„ÄÅ‰ª•‰∏ã„ÅÆË®≠ÂÆö„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ

## Google Apps ScriptÁµ±Âêà„ÅÆË®≠ÂÆöÊâãÈ†Ü

### 1. Google Apps Script„ÅÆÊ∫ñÂÇô
- Êèê‰æõ„Åï„Çå„ÅüApps Script„Ç≥„Éº„Éâ„Çí„Éá„Éó„É≠„Ç§
- „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàID„ÇíË®≠ÂÆö
- Web„Ç¢„Éó„É™„Å®„Åó„Å¶ÂÖ¨Èñã

### 2. Google Cloud Console„ÅÆË®≠ÂÆö
- OAuth 2.0„ÇØ„É©„Ç§„Ç¢„É≥„ÉàID„Çí‰ΩúÊàê
- ÊâøË™çÊ∏à„ÅøJavaScript„Ç™„É™„Ç∏„É≥„ÇíËøΩÂä†
- ÂøÖË¶Å„Å™API„ÇíÊúâÂäπÂåñ

### 3. „Åì„ÅÆ„Ç¢„Éó„É™„ÅÆË®≠ÂÆö
- CONFIG.APPS_SCRIPT_URL„ÇíÊõ¥Êñ∞
- CONFIG.CLIENT_ID„ÇíÊõ¥Êñ∞  
- CONFIG.DEMO_MODE„Çífalse„Å´Â§âÊõ¥

## ÁèæÂú®Âà©Áî®ÂèØËÉΩ„Å™Ê©üËÉΩ
- ‚úÖ „Éö„Éº„Ç∏„ÅÆ‰ΩúÊàê„ÉªÁ∑®ÈõÜ„ÉªÂâäÈô§
- ‚úÖ „É™„Ç¢„É´„Çø„Ç§„É†„Éó„É¨„Éì„É•„Éº
- ‚úÖ „É¨„Çπ„Éù„É≥„Ç∑„Éñ„Éá„Ç∂„Ç§„É≥
- ‚úÖ „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åß„ÅÆ‰øùÂ≠ò

## Áµ±ÂêàÂæå„Å´Âà©Áî®ÂèØËÉΩ„Å´„Å™„ÇãÊ©üËÉΩ
- üîÑ Google Sheets„Åß„ÅÆ„Éá„Éº„ÇøÊ∞∏Á∂öÂåñ
- üîÑ „Éû„É´„ÉÅ„É¶„Éº„Ç∂„ÉºÂØæÂøú
- üîÑ GitHub ActionsËá™ÂãïÂêåÊúü`,
                            updatedAt: new Date().toISOString()
                        }
                    ];
                    localStorage.setItem(storageKey, JSON.stringify(defaultPages));
                }
            }
            
            async initGoogleAuth() {
                return new Promise((resolve, reject) => {
                    gapi.load('auth2', () => {
                        gapi.auth2.init({
                            client_id: CONFIG.CLIENT_ID
                        }).then((authInstance) => {
                            this.setState({ authInstance });
                            this.setState({ isAuthenticated: authInstance.isSignedIn.get() });
                            
                            // „Çµ„Ç§„É≥„Ç§„É≥Áä∂ÊÖã„ÅÆÂ§âÊõ¥„ÇíÁõ£Ë¶ñ
                            authInstance.isSignedIn.listen((isSignedIn) => {
                                this.setState({ isAuthenticated: isSignedIn });
                                if (isSignedIn) {
                                    this.loadPages();
                                }
                            });
                            
                            resolve(authInstance);
                        }).catch(reject);
                    });
                });
            }
            
            setState(newState) {
                this.state = { ...this.state, ...newState };
                if (this.state.initialized) {
                    this.render();
                }
            }
            
            async loadPages() {
                this.setState({ loading: true });
                
                try {
                    let pages;
                    if (CONFIG.DEMO_MODE) {
                        const storageKey = 'notion-wiki-pages';
                        pages = JSON.parse(localStorage.getItem(storageKey) || '[]');
                        pages.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
                    } else {
                        const result = await this.apiCall('getPages');
                        pages = result.pages || [];
                    }
                    
                    this.setState({ pages, loading: false });
                } catch (error) {
                    console.error('„Éö„Éº„Ç∏Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                    this.setState({ 
                        statusMessage: '„Éö„Éº„Ç∏„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü',
                        loading: false 
                    });
                }
            }
            
            async loadPage(pageId) {
                this.setState({ loading: true });
                
                try {
                    let page;
                    if (CONFIG.DEMO_MODE) {
                        const pages = JSON.parse(localStorage.getItem('notion-wiki-pages') || '[]');
                        page = pages.find(p => p.id === pageId);
                    } else {
                        const result = await this.apiCall('getPage', 'GET', { id: pageId });
                        page = result.page;
                    }
                    
                    if (page) {
                        this.setState({
                            currentPage: page,
                            title: page.title || '',
                            content: page.content || '',
                            isEditing: false,
                            loading: false
                        });
                    }
                } catch (error) {
                    console.error('„Éö„Éº„Ç∏Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                    this.setState({ 
                        statusMessage: '„Éö„Éº„Ç∏„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü',
                        loading: false 
                    });
                }
            }
            
            async savePage() {
                const { title, content, currentPage } = this.state;
                this.setState({ loading: true });
                
                try {
                    const pageData = {
                        id: currentPage?.id || Date.now().toString(),
                        title: title.trim() || 'ÁÑ°È°å',
                        content: content
                    };
                    
                    if (CONFIG.DEMO_MODE) {
                        const pages = JSON.parse(localStorage.getItem('notion-wiki-pages') || '[]');
                        const existingIndex = pages.findIndex(p => p.id === pageData.id);
                        
                        const updatedPage = {
                            ...pageData,
                            updatedAt: new Date().toISOString()
                        };
                        
                        if (existingIndex >= 0) {
                            pages[existingIndex] = updatedPage;
                        } else {
                            pages.push(updatedPage);
                        }
                        
                        localStorage.setItem('notion-wiki-pages', JSON.stringify(pages));
                        
                        this.setState({
                            currentPage: updatedPage,
                            isEditing: false,
                            statusMessage: '‰øùÂ≠ò„Åó„Åæ„Åó„Åü',
                            loading: false
                        });
                    } else {
                        const result = await this.apiCall('savePage', 'POST', pageData);
                        
                        if (result.success) {
                            this.setState({
                                statusMessage: '‰øùÂ≠ò„Åó„Åæ„Åó„Åü',
                                isEditing: false,
                                loading: false
                            });
                            
                            if (!currentPage) {
                                this.setState({ currentPage: pageData });
                            }
                        }
                    }
                    
                    await this.loadPages();
                    
                    setTimeout(() => {
                        this.setState({ statusMessage: '' });
                    }, 2000);
                    
                } catch (error) {
                    console.error('‰øùÂ≠ò„Ç®„É©„Éº:', error);
                    this.setState({ 
                        statusMessage: '‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü',
                        loading: false 
                    });
                }
            }
            
            createNewPage() {
                const { newPageTitle } = this.state;
                if (!newPageTitle.trim()) return;
                
                this.setState({
                    currentPage: null,
                    title: newPageTitle,
                    content: '',
                    isEditing: true,
                    newPageTitle: ''
                });
            }
            
            async apiCall(endpoint, method = 'GET', data = null) {
                if (CONFIG.DEMO_MODE) {
                    throw new Error('„Éá„É¢„É¢„Éº„Éâ„Åß„ÅØAPI„Ç≥„Éº„É´„ÅØÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');
                }
                
                const { authInstance } = this.state;
                if (!authInstance || !authInstance.isSignedIn.get()) {
                    throw new Error('„É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô');
                }

                const token = authInstance.currentUser.get().getAuthResponse().access_token;
                
                const url = new URL(CONFIG.APPS_SCRIPT_URL);
                url.searchParams.set('action', endpoint);
                
                const options = {
                    method,
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                };

                if (data && method !== 'GET') {
                    options.body = JSON.stringify(data);
                } else if (data && method === 'GET') {
                    Object.keys(data).forEach(key => {
                        url.searchParams.set(key, data[key]);
                    });
                }

                const response = await fetch(url.toString(), options);
                if (!response.ok) {
                    throw new Error(`API „Ç®„É©„Éº: ${response.status}`);
                }
                return response.json();
            }
            
            signIn() {
                if (this.state.authInstance) {
                    this.state.authInstance.signIn();
                }
            }
            
            signOut() {
                if (this.state.authInstance) {
                    this.state.authInstance.signOut();
                }
            }
            
            render() {
                const app = document.getElementById('root');
                
                if (!this.state.initialized) {
                    return; // ÂàùÊúüÂåñ‰∏≠„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
                }
                
                if (!CONFIG.DEMO_MODE && !this.state.isAuthenticated) {
                    app.innerHTML = this.renderLoginScreen();
                    this.attachLoginListeners();
                    return;
                }
                
                app.innerHTML = `
                    <div class="app-container">
                        ${this.renderSidebar()}
                        ${this.renderMainContent()}
                    </div>
                `;
                
                this.attachEventListeners();
            }
            
            renderLoginScreen() {
                const configIssue = CONFIG.APPS_SCRIPT_URL.includes('YOUR_') || CONFIG.CLIENT_ID.includes('YOUR_');
                
                return `
                    <div class="app-container">
                        <div class="login-container">
                            ${configIssue ? `
                                <div class="config-notice">
                                    <strong>Ë®≠ÂÆö„ÅåÂøÖË¶Å„Åß„Åô</strong>
                                    CONFIG.APPS_SCRIPT_URL„Å®CONFIG.CLIENT_ID„ÇíÊ≠£„Åó„ÅÑÂÄ§„Å´Êõ¥Êñ∞„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                                    „Éá„É¢„É¢„Éº„Éâ„ÅßË©¶„ÅôÂ†¥Âêà„ÅØ„ÄÅCONFIG.DEMO_MODE„Çítrue„Å´Ë®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                                </div>
                            ` : ''}
                            <h1>NotionÈ¢®Wiki</h1>
                            <p>„Åì„ÅÆWiki„ÇíÁ∑®ÈõÜ„Åô„Çã„Å´„ÅØGoogle„Ç¢„Ç´„Ç¶„É≥„Éà„Åß„É≠„Ç∞„Ç§„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                            <button class="btn btn-primary" id="sign-in-btn" ${configIssue ? 'disabled' : ''}>
                                Google„Åß„É≠„Ç∞„Ç§„É≥
                            </button>
                        </div>
                    </div>
                `;
            }
            
            renderSidebar() {
                const { pages, currentPage, newPageTitle } = this.state;
                
                return `
                    <div class="sidebar">
                        <div class="sidebar-header">
                            <div class="sidebar-title">„Éö„Éº„Ç∏‰∏ÄË¶ß</div>
                            ${CONFIG.DEMO_MODE ? '<small style="color: #9b9a97;">(„Éá„É¢„É¢„Éº„Éâ)</small>' : ''}
                        </div>
                        
                        <ul class="page-list">
                            ${pages.map(page => `
                                <li class="page-item ${currentPage?.id === page.id ? 'active' : ''}"
                                    data-page-id="${page.id}">
                                    <span class="page-item-title">${this.escapeHtml(page.title || 'ÁÑ°È°å')}</span>
                                </li>
                            `).join('')}
                        </ul>
                        
                        <div class="new-page-form">
                            <input
                                type="text"
                                class="new-page-input"
                                placeholder="Êñ∞„Åó„ÅÑ„Éö„Éº„Ç∏„Çø„Ç§„Éà„É´"
                                value="${this.escapeHtml(newPageTitle)}"
                                id="new-page-input"
                            />
                            <button class="btn btn-primary" id="create-page-btn">ËøΩÂä†</button>
                        </div>
                    </div>
                `;
            }
            
            renderMainContent() {
                const { statusMessage } = this.state;
                
                return `
                    <div class="main-content">
                        ${this.renderHeader()}
                        ${statusMessage ? this.renderStatusMessage() : ''}
                        ${this.renderEditor()}
                    </div>
                `;
            }
            
            renderHeader() {
                const { currentPage, isEditing, loading } = this.state;
                
                let headerTitle = 'Êñ∞Ë¶è„Éö„Éº„Ç∏';
                if (currentPage) {
                    headerTitle = isEditing ? 'Á∑®ÈõÜ‰∏≠' : (currentPage.title || 'ÁÑ°È°å');
                }
                
                return `
                    <div class="header">
                        <div class="header-title">
                            ${loading ? '<span class="loading-spinner" style="margin-right: 10px;"></span>' : ''}
                            ${this.escapeHtml(headerTitle)}
                        </div>
                        <div class="header-actions">
                            ${currentPage && !isEditing ? `
                                <button class="btn" id="edit-btn" ${loading ? 'disabled' : ''}>Á∑®ÈõÜ</button>
                            ` : ''}
                            ${isEditing ? `
                                <button class="btn" id="cancel-btn" ${loading ? 'disabled' : ''}>„Ç≠„É£„É≥„Çª„É´</button>
                                <button class="btn btn-primary" id="save-btn" ${loading ? 'disabled' : ''}>
                                    ${loading ? '<span class="loading-spinner" style="margin-right: 5px;"></span>' : ''}
                                    ‰øùÂ≠ò
                                </button>
                            ` : ''}
                            ${!CONFIG.DEMO_MODE ? `
                                <button class="btn" id="sign-out-btn">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            renderStatusMessage() {
                const { statusMessage, loading } = this.state;
                let className = 'status-success';
                
                if (statusMessage.includes('Â§±Êïó') || statusMessage.includes('„Ç®„É©„Éº')) {
                    className = 'status-error';
                } else if (loading) {
                    className = 'status-loading';
                }
                
                return `
                    <div class="status-message ${className}">
                        ${this.escapeHtml(statusMessage)}
                    </div>
                `;
            }
            
            renderEditor() {
                const { currentPage, isEditing, title, content } = this.state;
                
                if (isEditing) {
                    return `
                        <div class="editor-container">
                            <div class="editor">
                                <input
                                    type="text"
                                    class="page-title"
                                    placeholder="ÁÑ°È°å"
                                    value="${this.escapeHtml(title)}"
                                    id="title-input"
                                />
                                <textarea
                                    class="editor-content"
                                    placeholder="‰Ωï„ÅãÊõ∏„ÅÑ„Å¶„Åø„Åæ„Åó„Çá„ÅÜ..."
                                    id="content-input"
                                >${this.escapeHtml(content)}</textarea>
                            </div>
                        </div>
                    `;
                } else if (currentPage) {
                    return `
                        <div class="editor-container">
                            <div class="editor">
                                <h1 class="page-title">${this.escapeHtml(currentPage.title || 'ÁÑ°È°å')}</h1>
                                <div class="viewer-content">${this.escapeHtml(currentPage.content || '„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì')}</div>
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="welcome-screen">
                            <h2>NotionÈ¢®Wiki„Å∏„Çà„ÅÜ„Åì„Åù</h2>
                            <p>Â∑¶„ÅÆ„Çµ„Ç§„Éâ„Éê„Éº„Åã„Çâ„Éö„Éº„Ç∏„ÇíÈÅ∏Êäû„Åô„Çã„Åã„ÄÅÊñ∞„Åó„ÅÑ„Éö„Éº„Ç∏„Çí‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                            ${CONFIG.DEMO_MODE ? '<p><em>ÁèæÂú®„Éá„É¢„É¢„Éº„Éâ„ÅßÂãï‰Ωú„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ</em></p>' : ''}
                        </div>
                    `;
                }
            }
            
            attachLoginListeners() {
                const signInBtn = document.getElementById('sign-in-btn');
                if (signInBtn && !signInBtn.disabled) {
                    signInBtn.addEventListener('click', () => this.signIn());
                }
            }
            
            attachEventListeners() {
                // „Éö„Éº„Ç∏„É™„Çπ„Éà„ÅÆ„ÇØ„É™„ÉÉ„ÇØ
                document.querySelectorAll('.page-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const pageId = item.dataset.pageId;
                        this.loadPage(pageId);
                    });
                });
                
                // Êñ∞Ë¶è„Éö„Éº„Ç∏‰ΩúÊàê
                const newPageInput = document.getElementById('new-page-input');
                const createBtn = document.getElementById('create-page-btn');
                
                if (newPageInput) {
                    newPageInput.addEventListener('input', (e) => {
                        this.setState({ newPageTitle: e.target.value });
                    });
                    
                    newPageInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' && !this.state.loading) {
                            this.createNewPage();
                        }
                    });
                }
                
                if (createBtn) {
                    createBtn.addEventListener('click', () => {
                        if (!this.state.loading) {
                            this.createNewPage();
                        }
                    });
                }
                
                // „Ç®„Éá„Ç£„Çø„ÉºÈñ¢ÈÄ£
                const titleInput = document.getElementById('title-input');
                const contentInput = document.getElementById('content-input');
                const editBtn = document.getElementById('edit-btn');
                const saveBtn = document.getElementById('save-btn');
                const cancelBtn = document.getElementById('cancel-btn');
                const signOutBtn = document.getElementById('sign-out-btn');
                
                if (titleInput) {
                    titleInput.addEventListener('input', (e) => {
                        this.setState({ title: e.target.value });
                    });
                }
                
                if (contentInput) {
                    contentInput.addEventListener('input', (e) => {
                        this.setState({ content: e.target.value });
                    });
                }
                
                if (editBtn) {
                    editBtn.addEventListener('click', () => {
                        if (!this.state.loading) {
                            this.setState({ isEditing: true });
                        }
                    });
                }
                
                if (saveBtn) {
                    saveBtn.addEventListener('click', () => {
                        if (!this.state.loading) {
                            this.savePage();
                        }
                    });
                }
                
                if (cancelBtn) {
                    cancelBtn.addEventListener('click', () => {
                        if (!this.state.loading) {
                            const { currentPage } = this.state;
                            if (currentPage) {
                                this.setState({
                                    isEditing: false,
                                    title: currentPage.title || '',
                                    content: currentPage.content || ''
                                });
                            } else {
                                this.setState({
                                    isEditing: false,
                                    title: '',
                                    content: '',
                                    currentPage: null
                                });
                            }
                        }
                    });
                }
                
                if (signOutBtn) {
                    signOutBtn.addEventListener('click', () => this.signOut());
                }
                
                // „Ç≠„Éº„Éú„Éº„Éâ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà
                document.addEventListener('keydown', (e) => {
                    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                        e.preventDefault();
                        if (this.state.isEditing && !this.state.loading) {
                            this.savePage();
                        }
                    }
                });
            }
            
            escapeHtml(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        // „Ç¢„Éó„É™„ÅÆÂàùÊúüÂåñ
        new WikiApp();
    </script>
</body>
</html>
